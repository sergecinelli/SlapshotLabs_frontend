<div class="schedule-form-modal">
  <h2 mat-dialog-title class="modal-title">
    <mat-icon class="title-icon">event</mat-icon>
    {{ isEditMode ? 'Edit Game' : 'Add Game' }}
  </h2>

  <mat-dialog-content class="modal-content">
    <div *ngIf="isLoading" class="loading-container">
      <p>Loading form data...</p>
    </div>

    <form *ngIf="!isLoading" [formGroup]="scheduleForm" class="schedule-form">
      <!-- Game Information -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Game Information</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>

        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Away Team</mat-label>
            <mat-select
              formControlName="awayTeam"
              (selectionChange)="onAwayTeamChange($event.value)"
            >
              <mat-option *ngFor="let option of teamOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="scheduleForm.get('awayTeam')?.errors && scheduleForm.get('awayTeam')?.touched"
            >
              {{ getErrorMessage('awayTeam') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Away Goalie</mat-label>
            <mat-select formControlName="awayTeamGoalie">
              <mat-option *ngFor="let option of awayGoalieOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="form-row">
          <app-button
            [bg]="'transparent'"
            [bghover]="'button_background'"
            [br]="'border'"
            [color]="'primary'"
            [colorhover]="'primary'"
            [opacity]="1"
            [opacityhover]="1"
            [width]="'auto'"
            [rounded]="false"
            [materialIcon]="'groups'"
            [haveContent]="true"
            [isDisabled]="!scheduleForm.get('awayTeam')?.value"
            (clicked)="openAwayRosterModal()"
          >
            Select Away Team Roster
          </app-button>
        </div>

        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Home Team</mat-label>
            <mat-select
              formControlName="homeTeam"
              (selectionChange)="onHomeTeamChange($event.value)"
            >
              <mat-option *ngFor="let option of teamOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="scheduleForm.get('homeTeam')?.errors && scheduleForm.get('homeTeam')?.touched"
            >
              {{ getErrorMessage('homeTeam') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Home Goalie</mat-label>
            <mat-select formControlName="homeTeamGoalie">
              <mat-option *ngFor="let option of homeGoalieOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="form-row">
          <app-button
            [bg]="'transparent'"
            [bghover]="'button_background'"
            [br]="'border'"
            [color]="'primary'"
            [colorhover]="'primary'"
            [opacity]="1"
            [opacityhover]="1"
            [width]="'auto'"
            [rounded]="false"
            [materialIcon]="'groups'"
            [haveContent]="true"
            [isDisabled]="!scheduleForm.get('homeTeam')?.value"
            (clicked)="openHomeRosterModal()"
          >
            Select Home Team Roster
          </app-button>
        </div>

        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Date</mat-label>
            <input matInput type="date" formControlName="date" />
            <mat-error
              *ngIf="scheduleForm.get('date')?.errors && scheduleForm.get('date')?.touched"
            >
              {{ getErrorMessage('date') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Time</mat-label>
            <input matInput type="text" formControlName="time" placeholder="e.g., 7:00 PM" />
            <mat-error
              *ngIf="scheduleForm.get('time')?.errors && scheduleForm.get('time')?.touched"
            >
              {{ getErrorMessage('time') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Venue Information -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Venue Information</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>

        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Arena</mat-label>
            <mat-select formControlName="arena" (selectionChange)="onArenaChange($event.value)">
              <mat-option *ngFor="let option of arenaOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="scheduleForm.get('arena')?.errors && scheduleForm.get('arena')?.touched"
            >
              {{ getErrorMessage('arena') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Rink</mat-label>
            <mat-select formControlName="rink">
              <mat-option *ngFor="let option of rinkOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="scheduleForm.get('rink')?.errors && scheduleForm.get('rink')?.touched"
            >
              {{ getErrorMessage('rink') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Game Details -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Game Details</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>

        <div class="game-type-selection-container">
          <div class="game-type-selection-label uppercase text-custom-secondary">Game Type</div>
          <div *ngIf="isLoading" class="loading-message">Loading game types...</div>
          <div class="game-type-buttons" *ngIf="!isLoading">
            <button
              *ngFor="let option of gameTypeOptions"
              type="button"
              class="game-type-button"
              [class.selected]="scheduleForm.get('gameType')?.value === option.value"
              (click)="selectGameType(option.value)"
            >
              <div class="game-type-name">{{ option.label }}</div>
            </button>
          </div>
          <div
            *ngIf="scheduleForm.get('gameType')?.errors && scheduleForm.get('gameType')?.touched"
            class="game-type-error"
          >
            {{ getErrorMessage('gameType') }}
          </div>
        </div>

        <div class="form-row" *ngIf="gameTypeNameOptions.length > 0">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary"
              >{{ selectedGameType?.name ?? '' }} Name</mat-label
            >
            <mat-select formControlName="gameTypeName">
              <mat-option *ngFor="let option of gameTypeNameOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="status-selection-container">
          <div class="status-selection-label uppercase text-custom-secondary">Status</div>
          <div class="status-buttons">
            <button
              *ngFor="let option of statusOptions"
              type="button"
              class="status-button"
              [class.selected]="scheduleForm.get('status')?.value === option.value"
              (click)="selectStatus(option.value)"
            >
              <div class="status-name">{{ option.label }}</div>
            </button>
          </div>
          <div
            *ngIf="scheduleForm.get('status')?.errors && scheduleForm.get('status')?.touched"
            class="status-error"
          >
            {{ getErrorMessage('status') }}
          </div>
        </div>
      </div>

      <!-- Analysis Section -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Analysis</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>
        <div class="form-row">
          <mat-form-field
            [floatLabel]="'always'"
            [hideRequiredMarker]="true"
            class="form-field full-width"
          >
            <mat-label class="uppercase text-custom-secondary">Analysis</mat-label>
            <textarea
              matInput
              formControlName="analysis"
              rows="3"
              placeholder="Enter analysis (optional)"
            ></textarea>
            <mat-error
              *ngIf="scheduleForm.get('analysis')?.errors && scheduleForm.get('analysis')?.touched"
            >
              {{ getErrorMessage('analysis') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="modal-actions">
    <app-button
      [bg]="'transparent'"
      [bghover]="'button_background'"
      [br]="'border'"
      [color]="'text_primary'"
      [colorhover]="'text_primary'"
      [opacity]="1"
      [opacityhover]="1"
      [width]="'auto'"
      [rounded]="false"
      [haveContent]="true"
      (clicked)="onCancel()"
    >
      Cancel
    </app-button>
    <app-button-loading
      [isLoading]="isLoading"
      [isDisabled]="scheduleForm.invalid"
      materialIcon="save"
      [bg]="isEditMode ? 'orange' : 'green'"
      [bghover]="isEditMode ? 'orange' : 'green'"
      [color]="'white'"
      [colorhover]="'white'"
      [opacity]="1"
      [opacityhover]="1"
      [width]="'auto'"
      [rounded]="false"
      [haveContent]="true"
      (clicked)="onSubmit()"
    >
      {{ isEditMode ? 'Update Game' : 'Add Game' }}
    </app-button-loading>
  </mat-dialog-actions>
</div>
