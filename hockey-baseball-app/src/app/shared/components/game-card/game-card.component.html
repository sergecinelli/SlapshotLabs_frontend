@let gameValue = game();
@let showActionsValue = showActions();
@let showScoreValue = showScore();
@let isDeletingValue = isDeleting();

<div class="game-card" [class.completed]="gameValue.status === GameStatus.GameOver" [class.in-progress]="gameValue.status === GameStatus.GameInProgress" [class.not-started]="gameValue.status === GameStatus.NotStarted">
  <!-- Card Header -->
  <div class="game-card-header">
    <div class="header-left">
      <div class="game-date-time-row">
        <div class="date-time-item">
          <span class="material-symbols-rounded date-time-icon">today</span>
          <span class="game-date">{{ gameValue.date }}</span>
        </div>
        @if (gameValue.time) {
          <div class="date-time-item">
            <span class="material-symbols-rounded date-time-icon">schedule</span>
            <span class="game-time">{{ formatTimeTo12Hour(gameValue.time) }}</span>
            @if (gameValue.periodName && gameValue.status !== GameStatus.NotStarted) {
              <span class="game-period-separator">-</span>
              <span class="game-period-text">{{ gameValue.periodName }}</span>
            }
          </div>
        }
      </div>
      @if (gameValue.gameType || gameValue.gameTypeName) {
        <div class="game-type-info">
          <div class="game-type-text">
            @if (gameValue.gameType && gameValue.gameTypeName) {
              <span class="game-type-bold">{{ gameValue.gameType }}</span><span class="game-type-separator"> - </span>{{ gameValue.gameTypeName }}
            } @else {
              <span class="game-type-bold">{{ gameValue.gameType || gameValue.gameTypeName }}</span>
            }
          </div>
        </div>
      }
    </div>
    <div class="header-right">
      <div class="game-status-row">
        <div class="status-badge" [class.live-badge]="gameValue.status === GameStatus.GameInProgress" [class.upcoming-badge]="gameValue.status === GameStatus.NotStarted" [class.completed-badge]="gameValue.status === GameStatus.GameOver">
          @if (gameValue.status === GameStatus.GameInProgress) {
            <span class="live-indicator"></span>
          }
          <span class="status-text">{{ getGameStatusLabel(gameValue.status).toUpperCase() }}</span>
        </div>
        @if (isOvertimeStatus(gameValue.statusName)) {
          <span class="game-period-badge">OT</span>
        }
      </div>
      <div class="venue-info">
        <div class="venue-name">
          @if (gameValue.arenaName && gameValue.rinkName) {
            {{ gameValue.arenaName }} - {{ gameValue.rinkName }}
          } @else if (gameValue.arenaRink) {
            {{ gameValue.arenaRink }}
          } @else {
            {{ getVenueName() }}
          }
        </div>
        @if (getVenueLocation()) {
          <div class="venue-location">{{ getVenueLocation() }}</div>
        }
      </div>
    </div>
  </div>

  <!-- Teams and Score Section -->
  <div class="game-teams-section">
    <!-- Home Team -->
    <div class="team-section team-section-left" [class.winning]="isWinning(true)">
      <div class="team-info team-info-left">
        <div class="team-name-group">
          @if (gameValue.homeTeamId) {
            <a
              class="team-name team-link"
              [routerLink]="['/teams-and-rosters/teams/team-profile', gameValue.homeTeamId]"
              [attr.aria-label]="'View ' + gameValue.homeTeam + ' profile'"
            >{{ gameValue.homeTeam }}</a>
          } @else {
            <div class="team-name">{{ gameValue.homeTeam }}</div>
          }
          <div class="team-location">{{ getTeamLocation(true) }}</div>
          @if (gameValue.homeTeamGoalie && gameValue.homeTeamGoalieId) {
            <a
              class="team-goalie goalie-link"
              [routerLink]="['/teams-and-rosters/goalies/goalie-profile', gameValue.homeTeamGoalieId]"
              [attr.aria-label]="'View ' + gameValue.homeTeamGoalie + ' profile'"
            >
              <span class="goalie-name">{{ gameValue.homeTeamGoalie }}</span>
              <span class="material-symbols-rounded goalie-icon">shield</span>
            </a>
          } @else if (gameValue.homeTeamGoalie) {
            <div class="team-goalie">
              <span class="goalie-name">{{ gameValue.homeTeamGoalie }}</span>
              <span class="material-symbols-rounded goalie-icon">shield</span>
            </div>
          }
        </div>
        @if (gameValue.homeTeamLogo) {
          <img [src]="gameValue.homeTeamLogo" [alt]="gameValue.homeTeam" class="team-logo" />
        } @else {
          <div class="team-logo-placeholder"></div>
        }
      </div>
    </div>

    <!-- Score in Center -->
    <div class="score-center-container">
      @if (showScoreValue) {
        <div class="team-score-wrapper" [class.winning-home]="isWinning(true)">
          <div class="team-score" [class.winning-score]="isWinning(true)">{{ gameValue.homeGoals }}</div>
        </div>
        <div class="score-separator">-</div>
        <div class="team-score-wrapper" [class.winning-away]="isWinning(false)">
          <div class="team-score" [class.winning-score]="isWinning(false)">{{ gameValue.awayGoals }}</div>
        </div>
      } @else {
        <div class="score-separator">at</div>
      }
    </div>

    <!-- Away Team (Reversed) -->
    <div class="team-section team-section-right" [class.winning]="isWinning(false)">
      <div class="team-info team-info-right">
        @if (gameValue.awayTeamLogo) {
          <img [src]="gameValue.awayTeamLogo" [alt]="gameValue.awayTeam" class="team-logo" />
        } @else {
          <div class="team-logo-placeholder"></div>
        }
        <div class="team-name-group">
          @if (gameValue.awayTeamId) {
            <a
              class="team-name team-link"
              [routerLink]="['/teams-and-rosters/teams/team-profile', gameValue.awayTeamId]"
              [attr.aria-label]="'View ' + gameValue.awayTeam + ' profile'"
            >{{ gameValue.awayTeam }}</a>
          } @else {
            <div class="team-name">{{ gameValue.awayTeam }}</div>
          }
          <div class="team-location">{{ getTeamLocation(false) }}</div>
          @if (gameValue.awayTeamGoalie && gameValue.awayTeamGoalieId) {
            <a
              class="team-goalie goalie-link"
              [routerLink]="['/teams-and-rosters/goalies/goalie-profile', gameValue.awayTeamGoalieId]"
              [attr.aria-label]="'View ' + gameValue.awayTeamGoalie + ' profile'"
            >
              <span class="material-symbols-rounded goalie-icon">shield</span>
              <span class="goalie-name">{{ gameValue.awayTeamGoalie }}</span>
            </a>
          } @else if (gameValue.awayTeamGoalie) {
            <div class="team-goalie">
              <span class="material-symbols-rounded goalie-icon">shield</span>
              <span class="goalie-name">{{ gameValue.awayTeamGoalie }}</span>
            </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  @if (gameValue.status === GameStatus.GameInProgress || gameValue.status === GameStatus.GameOver || showActionsValue) {
    <div class="game-card-actions">
      @if (gameValue.status === GameStatus.GameInProgress || gameValue.status === GameStatus.GameOver) {
        <app-button-route
          [route]="'/schedule/live/' + gameValue.id"
          [bg]="'green'"
          [bghover]="'green'"
          [color]="'white'"
          [colorhover]="'white'"
          [materialIcon]="'dashboard'"
          [haveContent]="true"
          class="action-button"
        >
          Dashboard
        </app-button-route>
      }
      @if (showActionsValue) {
        <app-button
          [bg]="'orange'"
          [bghover]="'orange'"
          [color]="'white'"
          [colorhover]="'white'"
          materialIcon="stylus"
          [haveContent]="true"
          (clicked)="onEdit()"
          class="action-button"
          role-visibility-name="edit-action"
        >
          Edit
        </app-button>
        <app-button-loading
          [isLoading]="isDeletingValue"
          [isDisabled]="isDeletingValue"
          [bg]="'primary'"
          [bghover]="'primary_dark'"
          [color]="'white'"
          [colorhover]="'white'"
          [materialIcon]="'delete'"
          [haveContent]="true"
          (clicked)="onDelete()"
          class="action-button"
          role-visibility-name="delete-action"
        >
          Delete
        </app-button-loading>
      }
    </div>
  }
</div>
