<div class="highlight-reel-form-modal">
  <h2 mat-dialog-title class="modal-title">
    <mat-icon class="title-icon">video_library</mat-icon>
    {{ isEditMode ? 'Edit Highlight Reel' : 'Create Highlight Reel' }}
  </h2>

  <mat-dialog-content class="modal-content">
    <div *ngIf="isLoading" class="loading-container flex items-center justify-center">
      <mat-spinner diameter="32"></mat-spinner>
    </div>

    <form *ngIf="!isLoading" [formGroup]="form" class="form">
      <div class="form-row">
        <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
          <mat-label class="uppercase text-custom-secondary">Name</mat-label>
          <input matInput formControlName="name" placeholder="Enter reel name">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
          <mat-label class="uppercase text-custom-secondary">Description</mat-label>
          <textarea matInput formControlName="description" rows="3" placeholder="Short description"></textarea>
        </mat-form-field>
      </div>

      <div class="two-column-layout">
        <!-- Left Column: Games List -->
        <div class="column games-column">
          <mat-accordion>
            <mat-expansion-panel *ngFor="let game of games()" (opened)="onPanelOpened(game)">
              <mat-expansion-panel-header>
                <mat-panel-title>{{ game.label }}</mat-panel-title>
              </mat-expansion-panel-header>

              <div *ngIf="game.loading" class="py-4 w-full flex items-center justify-center">
                <mat-spinner diameter="24" class="mx-auto"></mat-spinner>
              </div>

              <div *ngIf="!game.loading">
                <div *ngIf="game.events.length === 0" class="text-gray-500 px-2 py-2">No events.</div>
                <div class="event-list">
                  <div class="event-row header" *ngIf="game.events.length > 0">
                    <div class="col time">Time</div>
                    <div class="col team">Team</div>
                    <div class="col event">Event</div>
                    <div class="col player">Player</div>
                    <div class="col desc">Description</div>
                  </div>
                  <ng-container *ngFor="let row of groupedEvents(game)">
                    <div class="event-row period-row" *ngIf="row.header">
                      <div class="period-label">{{ row.header }}</div>
                    </div>
                    <div 
                      class="event-row clickable" 
                      *ngIf="!row.header && row.ev as ev"
                      (click)="onEventClick(game, ev)"
                      [class.selected]="isEventSelected(ev.id)">
                      <div class="col time">{{ timeOf(game, ev) }}</div>
                      <div class="col team">
                        <div class="team-cell">
                          <div class="logo">
                            <img [src]="getTeamLogoUrl(ev.team_id)" [alt]="teamNameOf(game, ev)" />
                          </div>
                          <span class="team-name">{{ teamNameOf(game, ev) }}</span>
                        </div>
                      </div>
                      <div class="col event">{{ eventTextOf(ev) }}</div>
                      <div class="col player">{{ playerNameOf(game, ev) }}</div>
                      <div class="col desc">{{ descriptionOf(ev) }}</div>
                    </div>
                  </ng-container>
                </div>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
        </div>

        <!-- Right Column: Selected Events Table -->
        <div class="column selected-column">
          <div class="selected-events-table">
            <div *ngIf="selectedEvents().length === 0" class="empty-state">
              <mat-icon>info</mat-icon>
              <p>Click events from the games list to add them here</p>
            </div>

            <div *ngIf="selectedEvents().length > 0" class="table-wrapper">
              <div class="table-header">
                <div class="th name">Name</div>
                <div class="th description">Description</div>
                <div class="th date">Date</div>
                <div class="th period-time">Period/Time</div>
                <div class="th actions">Actions</div>
              </div>
              <div class="table-body">
                <div class="table-row" *ngFor="let event of selectedEvents()">
                  <div class="td name">{{ event.eventName }}</div>
                  <div class="td description">{{ event.description || '-' }}</div>
                  <div class="td date">{{ event.date }}</div>
                  <div class="td period-time">{{ event.periodTime }}</div>
                  <div class="td actions">
                    <button 
                      mat-icon-button 
                      color="warn" 
                      (click)="removeSelectedEvent(event.id)"
                      title="Remove">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="modal-actions">
    <button mat-stroked-button (click)="onCancel()" class="cancel-btn">Cancel</button>
    <button mat-raised-button color="primary" (click)="onSubmit()" class="submit-btn" [disabled]="form.invalid">
      <mat-icon>save</mat-icon>
      {{ isEditMode ? 'Update Highlight Reel' : 'Create Highlight Reel' }}
    </button>
  </mat-dialog-actions>
</div>