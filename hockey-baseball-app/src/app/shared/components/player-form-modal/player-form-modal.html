<div class="player-form-modal">
  <h2 mat-dialog-title class="modal-title">
    <span class="material-symbols-rounded title-icon">sports_hockey</span>
    {{ isEditMode ? 'Edit Player' : 'Add Player' }}
  </h2>

  <mat-dialog-content class="modal-content">
    <div *ngIf="isLoading" class="loading-container">
      <p>Loading form data...</p>
    </div>
    <form [formGroup]="playerForm" class="player-form" *ngIf="!isLoading">
      <!-- Personal Information Section -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Personal Information</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>
        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Number:</mat-label>
            <input
              matInput
              type="number"
              formControlName="jerseyNumber"
              placeholder="Enter jersey number"
            />
            <mat-error
              *ngIf="
                playerForm.get('jerseyNumber')?.errors && playerForm.get('jerseyNumber')?.touched
              "
            >
              {{ getErrorMessage('jerseyNumber') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">First Name</mat-label>
            <input matInput formControlName="firstName" placeholder="Enter first name" />
            <mat-error
              *ngIf="playerForm.get('firstName')?.errors && playerForm.get('firstName')?.touched"
            >
              {{ getErrorMessage('firstName') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Last Name:</mat-label>
            <input matInput formControlName="lastName" placeholder="Enter last name" />
            <mat-error
              *ngIf="playerForm.get('lastName')?.errors && playerForm.get('lastName')?.touched"
            >
              {{ getErrorMessage('lastName') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Birth Year:</mat-label>
            <input
              matInput
              type="number"
              formControlName="birthYear"
              placeholder="Enter birth year"
            />
            <mat-error
              *ngIf="playerForm.get('birthYear')?.errors && playerForm.get('birthYear')?.touched"
            >
              {{ getErrorMessage('birthYear') }}
            </mat-error>
          </mat-form-field>

          <!-- Position Radio Buttons -->
          <div class="position-selection-container">
            <span class="position-selection-label uppercase text-custom-secondary">Position:</span>
            <div *ngIf="isLoading" class="loading-message">Loading positions...</div>
            <div class="position-buttons" *ngIf="!isLoading">
              <div
                *ngFor="let option of positionOptions"
                class="position-button"
                [class.selected]="playerForm.get('position')?.value === option.value"
                (click)="playerForm.patchValue({ position: option.value })"
                (keydown.enter)="playerForm.patchValue({ position: option.value })"
                (keydown.space)="playerForm.patchValue({ position: option.value })"
                tabindex="0"
                role="button"
                [attr.aria-pressed]="playerForm.get('position')?.value === option.value"
              >
                <span class="position-name">{{ option.label }}</span>
              </div>
            </div>
            <div
              class="position-error"
              *ngIf="playerForm.get('position')?.errors && playerForm.get('position')?.touched"
            >
              {{ getErrorMessage('position') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Physical Information Section -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Physical Information</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>
        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Height</mat-label>
            <input matInput formControlName="height" placeholder="e.g., 6'2&quot;" />
            <mat-error
              *ngIf="playerForm.get('height')?.errors && playerForm.get('height')?.touched"
            >
              {{ getErrorMessage('height') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Weight</mat-label>
            <input
              matInput
              type="number"
              formControlName="weight"
              placeholder="Enter weight in lbs"
            />
            <mat-error
              *ngIf="playerForm.get('weight')?.errors && playerForm.get('weight')?.touched"
            >
              {{ getErrorMessage('weight') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Birthplace:</mat-label>
            <input matInput formControlName="birthplace" placeholder="Country Born In" />
            <mat-error
              *ngIf="playerForm.get('birthplace')?.errors && playerForm.get('birthplace')?.touched"
            >
              {{ getErrorMessage('birthplace') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <!-- Shoots Radio Buttons -->
          <div class="shoots-selection-container">
            <span class="shoots-selection-label uppercase text-custom-secondary">Shoots (R/L)</span>
            <div class="shoots-buttons">
              <div
                *ngFor="let option of shootsOptions"
                class="shoots-button"
                [class.selected]="playerForm.get('shoots')?.value === option.value"
                (click)="playerForm.patchValue({ shoots: option.value })"
                (keydown.enter)="playerForm.patchValue({ shoots: option.value })"
                (keydown.space)="playerForm.patchValue({ shoots: option.value })"
                tabindex="0"
                role="button"
                [attr.aria-pressed]="playerForm.get('shoots')?.value === option.value"
              >
                <span class="shoots-name">{{ option.label }}</span>
              </div>
            </div>
            <div
              class="shoots-error"
              *ngIf="playerForm.get('shoots')?.errors && playerForm.get('shoots')?.touched"
            >
              {{ getErrorMessage('shoots') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Address Section -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Address</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>
        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Country</mat-label>
            <input matInput formControlName="addressCountry" placeholder="Enter country" />
            <mat-error
              *ngIf="
                playerForm.get('addressCountry')?.errors &&
                playerForm.get('addressCountry')?.touched
              "
            >
              {{ getErrorMessage('addressCountry') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">State/Province</mat-label>
            <input matInput formControlName="addressRegion" placeholder="Enter state or province" />
            <mat-error
              *ngIf="
                playerForm.get('addressRegion')?.errors && playerForm.get('addressRegion')?.touched
              "
            >
              {{ getErrorMessage('addressRegion') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">City</mat-label>
            <input matInput formControlName="addressCity" placeholder="Enter city" />
            <mat-error
              *ngIf="
                playerForm.get('addressCity')?.errors && playerForm.get('addressCity')?.touched
              "
            >
              {{ getErrorMessage('addressCity') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Street Address</mat-label>
            <input matInput formControlName="addressStreet" placeholder="Enter street address" />
            <mat-error
              *ngIf="
                playerForm.get('addressStreet')?.errors && playerForm.get('addressStreet')?.touched
              "
            >
              {{ getErrorMessage('addressStreet') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Postal Code</mat-label>
            <input matInput formControlName="addressPostalCode" placeholder="Enter postal code" />
            <mat-error
              *ngIf="
                playerForm.get('addressPostalCode')?.errors &&
                playerForm.get('addressPostalCode')?.touched
              "
            >
              {{ getErrorMessage('addressPostalCode') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Player Biography Section -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Player Biography</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>
        <div class="form-row">
          <mat-form-field
            [floatLabel]="'always'"
            [hideRequiredMarker]="true"
            class="form-field full-width"
          >
            <mat-label class="uppercase text-custom-secondary">Player Biography</mat-label>
            <textarea
              matInput
              formControlName="playerBiography"
              rows="4"
              placeholder="Enter player biography and background information"
            ></textarea>
            <mat-error
              *ngIf="
                playerForm.get('playerBiography')?.errors &&
                playerForm.get('playerBiography')?.touched
              "
            >
              {{ getErrorMessage('playerBiography') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Analysis Section -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Analysis</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>
        <div class="form-row">
          <mat-form-field
            [floatLabel]="'always'"
            [hideRequiredMarker]="true"
            class="form-field full-width"
          >
            <mat-label class="uppercase text-custom-secondary">Analysis</mat-label>
            <textarea
              matInput
              formControlName="analysis"
              rows="3"
              placeholder="Enter analysis (optional)"
            ></textarea>
            <mat-error
              *ngIf="playerForm.get('analysis')?.errors && playerForm.get('analysis')?.touched"
            >
              {{ getErrorMessage('analysis') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="modal-actions">
    <app-button
      [bg]="'transparent'"
      [bghover]="'button_background'"
      [br]="'border'"
      [color]="'text_primary'"
      [colorhover]="'text_primary'"
      [opacity]="1"
      [opacityhover]="1"
      [width]="'auto'"
      [rounded]="false"
      [haveContent]="true"
      (clicked)="onCancel()"
    >
      Cancel
    </app-button>
    <app-button-loading
      [isLoading]="isLoading"
      [isDisabled]="playerForm.invalid"
      materialIcon="save"
      [bg]="isEditMode ? 'orange' : 'green'"
      [bghover]="isEditMode ? 'orange' : 'green'"
      [color]="'white'"
      [colorhover]="'white'"
      [opacity]="1"
      [opacityhover]="1"
      [width]="'auto'"
      [rounded]="false"
      [haveContent]="true"
      (clicked)="onSubmit()"
    >
      {{ isEditMode ? 'Update Player' : 'Add Player' }}
    </app-button-loading>
  </mat-dialog-actions>
</div>
