<div class="player-form-modal">
  <h2 mat-dialog-title class="modal-title">
    <span class="material-symbols-rounded title-icon">sports_hockey</span>
    {{ isEditMode ? 'Edit Player' : 'Add Player' }}
  </h2>

  <mat-dialog-content class="modal-content">
    @if (isLoading) {
      <div class="loading-container">
        <p>Loading form data...</p>
      </div>
    }
    @if (!isLoading) {
      <form [formGroup]="playerForm" class="player-form">
        <!-- Personal Information Section -->
        <div class="form-section">
          <div class="section-header">
            <span class="section-title">Personal Information</span>
          </div>
          <mat-divider class="section-divider"></mat-divider>
          <div class="form-row">
            <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
              <mat-label class="uppercase text-custom-secondary">Number:</mat-label>
              <input
                matInput
                type="number"
                formControlName="jerseyNumber"
                placeholder="Enter jersey number"
                />
                @if (
                  playerForm.get('jerseyNumber')?.errors && playerForm.get('jerseyNumber')?.touched
                  ) {
                  <mat-error
                    >
                    {{ getErrorMessage('jerseyNumber') }}
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                <mat-label class="uppercase text-custom-secondary">First Name</mat-label>
                <input matInput formControlName="firstName" placeholder="Enter first name" />
                @if (playerForm.get('firstName')?.errors && playerForm.get('firstName')?.touched) {
                  <mat-error
                    >
                    {{ getErrorMessage('firstName') }}
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                <mat-label class="uppercase text-custom-secondary">Last Name:</mat-label>
                <input matInput formControlName="lastName" placeholder="Enter last name" />
                @if (playerForm.get('lastName')?.errors && playerForm.get('lastName')?.touched) {
                  <mat-error
                    >
                    {{ getErrorMessage('lastName') }}
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                <mat-label class="uppercase text-custom-secondary">Birth Year:</mat-label>
                <input
                  matInput
                  type="number"
                  formControlName="birthYear"
                  placeholder="Enter birth year"
                  />
                  @if (playerForm.get('birthYear')?.errors && playerForm.get('birthYear')?.touched) {
                    <mat-error
                      >
                      {{ getErrorMessage('birthYear') }}
                    </mat-error>
                  }
                </mat-form-field>
                <!-- Position Radio Buttons -->
                <div class="position-selection-container">
                  <span class="position-selection-label uppercase text-custom-secondary">Position:</span>
                  @if (isLoading) {
                    <div class="loading-message">Loading positions...</div>
                  }
                  @if (!isLoading) {
                    <div class="position-buttons">
                      @for (option of positionOptions; track option) {
                        <div
                          class="position-button"
                          [class.selected]="playerForm.get('position')?.value === option.value"
                          (click)="playerForm.patchValue({ position: option.value })"
                          (keydown.enter)="playerForm.patchValue({ position: option.value })"
                          (keydown.space)="playerForm.patchValue({ position: option.value })"
                          tabindex="0"
                          role="button"
                          [attr.aria-pressed]="playerForm.get('position')?.value === option.value"
                          >
                          <span class="position-name">{{ option.label }}</span>
                        </div>
                      }
                    </div>
                  }
                  @if (playerForm.get('position')?.errors && playerForm.get('position')?.touched) {
                    <div
                      class="position-error"
                      >
                      {{ getErrorMessage('position') }}
                    </div>
                  }
                </div>
              </div>
            </div>
            <!-- Physical Information Section -->
            <div class="form-section">
              <div class="section-header">
                <span class="section-title">Physical Information</span>
              </div>
              <mat-divider class="section-divider"></mat-divider>
              <div class="form-row">
                <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                  <mat-label class="uppercase text-custom-secondary">Height</mat-label>
                  <input matInput formControlName="height" placeholder="e.g., 6'2&quot;" />
                  @if (playerForm.get('height')?.errors && playerForm.get('height')?.touched) {
                    <mat-error
                      >
                      {{ getErrorMessage('height') }}
                    </mat-error>
                  }
                </mat-form-field>
                <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                  <mat-label class="uppercase text-custom-secondary">Weight</mat-label>
                  <input
                    matInput
                    type="number"
                    formControlName="weight"
                    placeholder="Enter weight in lbs"
                    />
                    @if (playerForm.get('weight')?.errors && playerForm.get('weight')?.touched) {
                      <mat-error
                        >
                        {{ getErrorMessage('weight') }}
                      </mat-error>
                    }
                  </mat-form-field>
                  <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                    <mat-label class="uppercase text-custom-secondary">Birthplace:</mat-label>
                    <input matInput formControlName="birthplace" placeholder="Country Born In" />
                    @if (playerForm.get('birthplace')?.errors && playerForm.get('birthplace')?.touched) {
                      <mat-error
                        >
                        {{ getErrorMessage('birthplace') }}
                      </mat-error>
                    }
                  </mat-form-field>
                </div>
                <div class="form-row">
                  <!-- Shoots Radio Buttons -->
                  <div class="shoots-selection-container">
                    <span class="shoots-selection-label uppercase text-custom-secondary">Shoots (R/L)</span>
                    <div class="shoots-buttons">
                      @for (option of shootsOptions; track option) {
                        <div
                          class="shoots-button"
                          [class.selected]="playerForm.get('shoots')?.value === option.value"
                          (click)="playerForm.patchValue({ shoots: option.value })"
                          (keydown.enter)="playerForm.patchValue({ shoots: option.value })"
                          (keydown.space)="playerForm.patchValue({ shoots: option.value })"
                          tabindex="0"
                          role="button"
                          [attr.aria-pressed]="playerForm.get('shoots')?.value === option.value"
                          >
                          <span class="shoots-name">{{ option.label }}</span>
                        </div>
                      }
                    </div>
                    @if (playerForm.get('shoots')?.errors && playerForm.get('shoots')?.touched) {
                      <div
                        class="shoots-error"
                        >
                        {{ getErrorMessage('shoots') }}
                      </div>
                    }
                  </div>
                </div>
              </div>
              <!-- Address Section -->
              <div class="form-section">
                <div class="section-header">
                  <span class="section-title">Address</span>
                </div>
                <mat-divider class="section-divider"></mat-divider>
                <div class="form-row">
                  <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                    <mat-label class="uppercase text-custom-secondary">Country</mat-label>
                    <input matInput formControlName="addressCountry" placeholder="Enter country" />
                    @if (
                      playerForm.get('addressCountry')?.errors &&
                      playerForm.get('addressCountry')?.touched
                      ) {
                      <mat-error
                        >
                        {{ getErrorMessage('addressCountry') }}
                      </mat-error>
                    }
                  </mat-form-field>
                  <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                    <mat-label class="uppercase text-custom-secondary">State/Province</mat-label>
                    <input matInput formControlName="addressRegion" placeholder="Enter state or province" />
                    @if (
                      playerForm.get('addressRegion')?.errors && playerForm.get('addressRegion')?.touched
                      ) {
                      <mat-error
                        >
                        {{ getErrorMessage('addressRegion') }}
                      </mat-error>
                    }
                  </mat-form-field>
                  <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                    <mat-label class="uppercase text-custom-secondary">City</mat-label>
                    <input matInput formControlName="addressCity" placeholder="Enter city" />
                    @if (
                      playerForm.get('addressCity')?.errors && playerForm.get('addressCity')?.touched
                      ) {
                      <mat-error
                        >
                        {{ getErrorMessage('addressCity') }}
                      </mat-error>
                    }
                  </mat-form-field>
                </div>
                <div class="form-row">
                  <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                    <mat-label class="uppercase text-custom-secondary">Street Address</mat-label>
                    <input matInput formControlName="addressStreet" placeholder="Enter street address" />
                    @if (
                      playerForm.get('addressStreet')?.errors && playerForm.get('addressStreet')?.touched
                      ) {
                      <mat-error
                        >
                        {{ getErrorMessage('addressStreet') }}
                      </mat-error>
                    }
                  </mat-form-field>
                  <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
                    <mat-label class="uppercase text-custom-secondary">Postal Code</mat-label>
                    <input matInput formControlName="addressPostalCode" placeholder="Enter postal code" />
                    @if (
                      playerForm.get('addressPostalCode')?.errors &&
                      playerForm.get('addressPostalCode')?.touched
                      ) {
                      <mat-error
                        >
                        {{ getErrorMessage('addressPostalCode') }}
                      </mat-error>
                    }
                  </mat-form-field>
                </div>
              </div>
              <!-- Player Biography Section -->
              <div class="form-section">
                <div class="section-header">
                  <span class="section-title">Player Biography</span>
                </div>
                <mat-divider class="section-divider"></mat-divider>
                <div class="form-row">
                  <mat-form-field
                    [floatLabel]="'always'"
                    [hideRequiredMarker]="true"
                    class="form-field full-width"
                    >
                    <mat-label class="uppercase text-custom-secondary">Player Biography</mat-label>
                    <textarea
                      matInput
                      formControlName="playerBiography"
                      rows="4"
                      placeholder="Enter player biography and background information"
                    ></textarea>
                    @if (
                      playerForm.get('playerBiography')?.errors &&
                      playerForm.get('playerBiography')?.touched
                      ) {
                      <mat-error
                        >
                        {{ getErrorMessage('playerBiography') }}
                      </mat-error>
                    }
                  </mat-form-field>
                </div>
              </div>
              <!-- Analysis Section -->
              <div class="form-section">
                <div class="section-header">
                  <span class="section-title">Analysis</span>
                </div>
                <mat-divider class="section-divider"></mat-divider>
                <div class="form-row">
                  <mat-form-field
                    [floatLabel]="'always'"
                    [hideRequiredMarker]="true"
                    class="form-field full-width"
                    >
                    <mat-label class="uppercase text-custom-secondary">Analysis</mat-label>
                    <textarea
                      matInput
                      formControlName="analysis"
                      rows="3"
                      placeholder="Enter analysis (optional)"
                    ></textarea>
                    @if (playerForm.get('analysis')?.errors && playerForm.get('analysis')?.touched) {
                      <mat-error
                        >
                        {{ getErrorMessage('analysis') }}
                      </mat-error>
                    }
                  </mat-form-field>
                </div>
              </div>
            </form>
          }
        </mat-dialog-content>

        <mat-dialog-actions class="modal-actions">
          <app-button
            [bg]="'transparent'"
            [bghover]="'button_background'"
            [br]="'border'"
            [color]="'text_primary'"
            [colorhover]="'text_primary'"
            [opacity]="1"
            [opacityhover]="1"
            [width]="'auto'"
            [rounded]="false"
            [haveContent]="true"
            (clicked)="onCancel()"
            >
            Cancel
          </app-button>
          <app-button-loading
            [isLoading]="isLoading"
            [isDisabled]="playerForm.invalid"
            materialIcon="save"
            [bg]="isEditMode ? 'orange' : 'green'"
            [bghover]="isEditMode ? 'orange' : 'green'"
            [color]="'white'"
            [colorhover]="'white'"
            [opacity]="1"
            [opacityhover]="1"
            [width]="'auto'"
            [rounded]="false"
            [haveContent]="true"
            (clicked)="onSubmit()"
            >
            {{ isEditMode ? 'Update Player' : 'Add Player' }}
          </app-button-loading>
        </mat-dialog-actions>
      </div>
