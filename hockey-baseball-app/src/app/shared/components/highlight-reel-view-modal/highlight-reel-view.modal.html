@let videoUrlValue = videoUrl();
@let videoMessageValue = videoMessage();
@let highlightsValue = highlights();
@let selectedIndexValue = selectedIndex();

<div class="highlight-reel-view-modal">
  <h2 mat-dialog-title class="modal-title">
    <span class="material-symbols-rounded title-icon">play_circle</span>
    View Highlight Reel â€” {{ data.reelName }}
  </h2>

  <mat-dialog-content class="modal-content">
    <div class="two-column-layout">
      <!-- LEFT: YouTube Player -->
      <div class="column left">
        @if (videoUrlValue) {
          <div class="video-wrapper">
            <iframe
              class="video-iframe"
              [src]="videoUrlValue"
              title="Highlight video"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
              >
            </iframe>
          </div>
        } @else {
          <div class="no-video">
            <span class="material-symbols-rounded">info</span>
            <p>{{ videoMessageValue || 'Select a highlight on the right to play' }}</p>
          </div>
        }
      </div>

      <!-- RIGHT: Reused Selected Events Table (read-only, clickable rows) -->
      <div class="column right selected-events-table">
        @if (highlightsValue.length === 0) {
          <div class="empty-state">
            <span class="material-symbols-rounded">info</span>
            <p>No highlights in this reel.</p>
          </div>
        }

        @if (highlightsValue.length > 0) {
          <div class="table-wrapper">
            <table class="w-full">
              <thead>
                <tr class="custom-header">
                  <th class="header-cell">Name</th>
                  <th class="header-cell">Description</th>
                  <th class="header-cell">Date</th>
                  <th class="header-cell">Time</th>
                </tr>
              </thead>
              <tbody>
                @for (h of highlightsValue; track h; let i = $index) {
                  <tr
                    class="table-row cursor-pointer"
                    (click)="onRowClick(i)"
                    [class.selected-row]="i === selectedIndexValue"
                    >
                    <td class="table-cell">{{ h.event_name || '-' }}</td>
                    <td class="table-cell">{{ h.note || '-' }}</td>
                    <td class="table-cell">{{ formatDate(h.date, h.time) }}</td>
                    <td class="table-cell">{{ formatPeriodTime(h.time, h.date) }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions class="modal-actions">
    <app-button
      [bg]="'transparent'"
      [bghover]="'button_background'"
      [br]="'border'"
      [color]="'text_primary'"
      [colorhover]="'text_primary'"
      [opacity]="1"
      [opacityhover]="1"
      [width]="'auto'"
      [rounded]="false"
      [haveContent]="true"
      (clicked)="close()"
      >
      Close
    </app-button>
  </mat-dialog-actions>
</div>
