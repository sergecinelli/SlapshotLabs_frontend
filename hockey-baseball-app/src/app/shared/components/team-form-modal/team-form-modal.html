<div class="team-form-modal">
  <h2 mat-dialog-title class="modal-title">
    <mat-icon class="title-icon">groups</mat-icon>
    {{ isEditMode ? 'Edit Team' : 'Add New Team' }}
  </h2>

  <mat-dialog-content class="modal-content">
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading options...</p>
    </div>

    <form *ngIf="!isLoading" [formGroup]="teamForm" class="team-form">
      <!-- Team Information -->
      <div class="form-section">
        <div class="section-header">
          <span class="section-title">Team Information</span>
        </div>
        <mat-divider class="section-divider"></mat-divider>

        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="false" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Team Name</mat-label>
            <input matInput formControlName="name" placeholder="Enter team name" />
            <mat-error *ngIf="teamForm.get('name')?.errors && teamForm.get('name')?.touched">
              {{ getErrorMessage('name') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="false" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Group</mat-label>
            <mat-select formControlName="group">
              <mat-option *ngFor="let option of groupOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="teamForm.get('group')?.errors && teamForm.get('group')?.touched">
              {{ getErrorMessage('group') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="false" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Level</mat-label>
            <mat-select formControlName="level">
              <mat-option *ngFor="let option of levelOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="teamForm.get('level')?.errors && teamForm.get('level')?.touched">
              {{ getErrorMessage('level') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="false" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Division</mat-label>
            <mat-select formControlName="division">
              <mat-option *ngFor="let option of divisionOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="teamForm.get('division')?.errors && teamForm.get('division')?.touched"
            >
              {{ getErrorMessage('division') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">City</mat-label>
            <input matInput formControlName="city" placeholder="Enter city" />
            <mat-error *ngIf="teamForm.get('city')?.errors && teamForm.get('city')?.touched">
              {{ getErrorMessage('city') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="form-field">
            <mat-label class="uppercase text-custom-secondary">Abbreviation</mat-label>
            <input matInput formControlName="abbreviation" placeholder="Enter abbreviation" />
            <mat-error
              *ngIf="teamForm.get('abbreviation')?.errors && teamForm.get('abbreviation')?.touched"
            >
              {{ getErrorMessage('abbreviation') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <div class="form-field logo-picker-container">
            <div class="uppercase text-custom-secondary logo-label">Team Logo</div>

            <!-- Hidden file input -->
            <input
              type="file"
              accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
              (change)="onFileSelected($event)"
              style="display: none"
              #fileInput
            />

            <!-- Image preview or upload button -->
            <div
              class="logo-preview-area"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)"
              [class.dragging]="isDragging"
            >
              <!-- Upload placeholder -->
              <button
                *ngIf="!imagePreview"
                type="button"
                class="upload-placeholder"
                (click)="triggerFileInput()"
              >
                <mat-icon class="upload-icon">cloud_upload</mat-icon>
                <span class="upload-text">{{
                  isDragging ? 'Drop image here' : 'Click or drag to upload logo'
                }}</span>
                <span class="upload-hint">JPEG, PNG, GIF, WebP (max 5MB)</span>
              </button>

              <!-- Image preview -->
              <div *ngIf="imagePreview" class="image-preview" [class.loading]="isImageLoading">
                <img
                  [src]="imagePreview"
                  alt="Team logo preview"
                  class="preview-image"
                  [style.opacity]="isImageLoading ? '0' : '1'"
                  (load)="onImageLoad()"
                  (error)="onImageError()"
                />
                <div *ngIf="isImageLoading" class="image-loading-overlay">
                  <mat-spinner diameter="40"></mat-spinner>
                </div>
                <button
                  *ngIf="!isImageLoading"
                  mat-icon-button
                  class="remove-image-btn"
                  (click)="removeImage()"
                  type="button"
                >
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>

            <!-- Error message -->
            <div *ngIf="imageError" class="image-error">
              <mat-icon class="error-icon">error</mat-icon>
              <span>{{ imageError }}</span>
            </div>
          </div>
        </div>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="modal-actions">
    <app-button
      [bg]="'transparent'"
      [bghover]="'button_background'"
      [br]="'border'"
      [color]="'text_primary'"
      [colorhover]="'text_primary'"
      [opacity]="1"
      [opacityhover]="1"
      [width]="'auto'"
      [rounded]="false"
      [haveContent]="true"
      (clicked)="onCancel()"
    >
      Cancel
    </app-button>
    <app-button-loading
      [isLoading]="isLoading"
      [isDisabled]="teamForm.invalid"
      materialIcon="save"
      [bg]="isEditMode ? 'orange' : 'green'"
      [bghover]="isEditMode ? 'orange' : 'green'"
      [color]="'white'"
      [colorhover]="'white'"
      [opacity]="1"
      [opacityhover]="1"
      [width]="'auto'"
      [rounded]="false"
      [haveContent]="true"
      (clicked)="onSubmit()"
    >
      {{ isEditMode ? 'Update Team' : 'Add Team' }}
    </app-button-loading>
  </mat-dialog-actions>
</div>
