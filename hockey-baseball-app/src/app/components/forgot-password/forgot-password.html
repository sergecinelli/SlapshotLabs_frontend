<!-- Forgot Password Page -->
<app-auth-layout titleText="FORGOT PASSWORD">
  <!-- Email Input Form (Before email is sent) -->
  @if (!isEmailSent) {
    <div>
      <p class="text-gray-600 mb-6">
        Enter your email address and we'll send you a link to reset your password.
      </p>

      <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()">
        <div class="space-y-0">
          <!-- Email Address -->
          <mat-form-field [floatLabel]="'always'" [hideRequiredMarker]="true" class="w-full">
            <mat-label class="uppercase text-custom-secondary">Email Address</mat-label>
            <input
              matInput
              type="email"
              autocomplete="email"
              formControlName="email"
              placeholder="Enter your email"
            />
            @if (email?.invalid && (email?.dirty || email?.touched)) {
              <mat-error>
                @if (email?.errors?.['required']) {
                  Email address is required
                }
                @if (email?.errors?.['email']) {
                  Please enter a valid email address
                }
              </mat-error>
            }
          </mat-form-field>

          <!-- General Error Message -->
          @if (errorMessage) {
            <div class="text-red-600 text-sm mt-2">
              {{ errorMessage }}
            </div>
          }
        </div>

        <div class="flex justify-center flex-col text-center mt-6">
          <!-- Send Email Button -->
          <app-auth-button
            text="SEND RESET LINK"
            loadingText="SENDING..."
            type="submit"
            [loading]="isLoading"
            [disabled]="isLoading"
          ></app-auth-button>

          <app-auth-link
            text="Remember your password?"
            linkText="Back to Login"
            (linkClicked)="navigateToSignIn()"
            class="mt-4"
          ></app-auth-link>
        </div>
      </form>
    </div>
  }

  <!-- Success Message (After email is sent) -->
  @if (isEmailSent) {
    <div class="text-center">
      <div class="mb-6">
        <div
          class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <svg
            class="w-8 h-8 text-green-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 13l4 4L19 7"
            ></path>
          </svg>
        </div>
        <h3 class="text-base font-medium text-custom-primary mb-2">Email Sent!</h3>
        <p class="text-gray-600 mb-6">
          We've sent a password reset link to <strong>{{ emailValue }}</strong>. 
          Check your inbox and follow the instructions to reset your password.
        </p>
      </div>

      <div class="space-y-0">
        <!-- Resend Email Button -->
        <app-auth-button
          text="RESEND EMAIL"
          loadingText="SENDING..."
          variant="outlined"
          class="w-full"
          [loading]="isLoading"
          [disabled]="!canResend || isLoading"
          (clicked)="onResendEmail()"
        ></app-auth-button>
        
        <!-- Countdown text for when button is disabled -->
        @if (!canResend && resendCountdown > 0) {
          <p class="text-gray-600">Resend available in {{ resendCountdown }}s</p>
        }

        <app-auth-link
          text=""
          linkText="Back to Login"
          (linkClicked)="navigateToSignIn()"
        ></app-auth-link>
      </div>
    </div>
  }
</app-auth-layout>
