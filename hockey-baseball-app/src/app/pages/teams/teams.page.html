@let loadingValue = loading();
@let teamsValue = teams();
@let layoutModeValue = layoutMode();

<div class="page-content" [appVisibilityMap]="visibilityByRoleMap">

  <!-- Header with Add Button -->
  <div class="teams-header">
    <div class="teams-header-left"></div>
    <div class="teams-header-actions" style="display: flex; gap: 10px; align-items: center;">
      <!-- View Toggle Button -->
      <app-button
        [materialIcon]="layoutModeValue === 'card' ? 'table_rows' : 'grid_view'"
        [bg]="'white'"
        [bghover]="'gray_tone3'"
        [color]="'text_primary'"
        [colorhover]="'primary'"
        [width]="'auto'"
        [rounded]="false"
        [haveContent]="true"
        (clicked)="toggleLayout()"
      >
        {{ layoutModeValue === 'card' ? 'Table View' : 'Card View' }}
      </app-button>

      <div class="add-team-button-wrapper" role-visibility-name="add-team-button">
        <app-button
          materialIcon="add"
          [bg]="'primary'"
          [bghover]="'primary_dark'"
          [color]="'white'"
          [colorhover]="'white'"
          [opacity]="1"
          [opacityhover]="1"
          [width]="'auto'"
          [rounded]="false"
          [haveContent]="true"
          (clicked)="openAddTeamModal()"
        >
          Add a Team
        </app-button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (loadingValue) {
    <div class="teams-loading">
      <div class="loading-text">Loading teams...</div>
    </div>
  }

  <!-- Empty State -->
  @if (!loadingValue && teamsValue.length === 0) {
    <div class="teams-empty">
      <div class="empty-text">No teams found.</div>
    </div>
  }

  <!-- Content based on layout mode -->
  @if (!loadingValue && teamsValue.length > 0) {
    @if (layoutModeValue === 'card') {
      <!-- Card View -->
      <div class="teams-cards-container">
        @for (team of teamsValue; track team.id) {
          <div class="team-card">
            <!-- Card Header -->
            <div class="team-card-header">
              <div class="header-left">
                <div class="team-name-row">
                  @if (team.logo) {
                    <img [src]="team.logo" [alt]="team.name" class="team-logo" />
                  } @else {
                    <div class="team-logo-placeholder"></div>
                  }
                  <div class="team-name-group">
                    <div
                      class="team-name team-link"
                      (click)="viewTeamProfile(team)"
                      (keyup.enter)="viewTeamProfile(team)"
                      (keyup.space)="viewTeamProfile(team)"
                      tabindex="0"
                      role="button"
                      [attr.aria-label]="'View ' + team.name + ' profile'"
                    >{{ team.name }}</div>
                    @if (team.abbreviation) {
                      <div class="team-abbreviation">{{ team.abbreviation }}</div>
                    }
                  </div>
                </div>
                <div class="team-info-row">
                  <div class="team-info-item">
                    <span class="team-info-label">Group:</span>
                    <span class="team-info-value">{{ team.group }}</span>
                  </div>
                  <div class="team-info-item">
                    <span class="team-info-label">Level:</span>
                    <span class="team-info-value">{{ team.level }}</span>
                  </div>
                  @if (team.division) {
                    <div class="team-info-item">
                      <span class="team-info-label">Division:</span>
                      <span class="team-info-value">{{ team.division }}</span>
                    </div>
                  }
                  @if (team.city) {
                    <div class="team-info-item">
                      <span class="team-info-label">City:</span>
                      <span class="team-info-value">{{ team.city }}</span>
                    </div>
                  }
                </div>
              </div>
            </div>

            <!-- Stats Section -->
            <div class="team-stats-section">
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-label">GP</div>
                  <div class="stat-value">{{ team.gamesPlayed }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">W</div>
                  <div class="stat-value">{{ team.wins }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">L</div>
                  <div class="stat-value">{{ team.losses }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">T</div>
                  <div class="stat-value">{{ team.ties }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">PTS</div>
                  <div class="stat-value stat-value-highlight">{{ team.points }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">GF</div>
                  <div class="stat-value">{{ team.goalsFor }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">GA</div>
                  <div class="stat-value">{{ team.goalsAgainst }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">GD</div>
                  <div class="stat-value">{{ team.goalsFor - team.goalsAgainst }}</div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="team-card-actions">
              <app-button-route
                [route]="'/teams-and-rosters/teams/' + team.id + '/schedule'"
                [bg]="'secondary'"
                [bghover]="'secondary_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                [materialIcon]="'scoreboard'"
                [haveContent]="true"
                class="action-button"
              >
                Schedule
              </app-button-route>
              <app-button-route
                [route]="'/teams-and-rosters/players'"
                [queryParams]="getPlayersQueryParams(team)"
                [bg]="'secondary'"
                [bghover]="'secondary_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                [materialIcon]="'people'"
                [haveContent]="true"
                class="action-button"
              >
                Players
              </app-button-route>
              <app-button-route
                [route]="'/teams-and-rosters/goalies'"
                [queryParams]="getGoaliesQueryParams(team)"
                [bg]="'secondary'"
                [bghover]="'secondary_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                [materialIcon]="'shield'"
                [haveContent]="true"
                class="action-button"
              >
                Goalies
              </app-button-route>
              <app-button-route
                [route]="'/teams-and-rosters/teams/' + team.id + '/profile'"
                [bg]="'green'"
                [bghover]="'green_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                [materialIcon]="'visibility'"
                [haveContent]="true"
                class="action-button"
              >
                View
              </app-button-route>
              <app-button
                [bg]="'orange'"
                [bghover]="'orange_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                materialIcon="stylus"
                [haveContent]="true"
                (clicked)="editTeam(team)"
                class="action-button"
                role-visibility-name="edit-action"
              >
                Edit
              </app-button>
              <app-button
                [bg]="'primary'"
                [bghover]="'primary_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                [materialIcon]="'delete'"
                [haveContent]="true"
                (clicked)="deleteTeam(team)"
                class="action-button"
                role-visibility-name="delete-action"
              >
                Delete
              </app-button>
            </div>
          </div>
        }
      </div>
    } @else {
      <!-- Table View -->
      <div class="teams-table-container">
        <app-data-table
          [columns]="tableColumns"
          [data]="teamsValue"
          [actions]="tableActions"
          [loading]="loadingValue"
          (actionClick)="onActionClick($event)"
          (sort)="onSort($event)"
          emptyMessage="No teams found."
        ></app-data-table>
      </div>
    }
  }
</div>
