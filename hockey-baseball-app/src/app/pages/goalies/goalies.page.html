@let loadingValue = loading();
@let goaliesValue = goalies();
@let layoutModeValue = layoutMode();
@let teamIdValue = teamId();
@let pageTitleValue = pageTitle();

<div class="page-content" [appVisibilityMap]="visibilityByRoleMap">

  <!-- Header with Add Button -->
  <div class="goalies-header">
    <div class="goalies-header-left">
      <h2>{{ pageTitleValue }}</h2>
    </div>
    <div class="goalies-header-actions" style="display: flex; gap: 10px; align-items: center;">
      <!-- View Toggle Button -->
      <app-button
        [materialIcon]="layoutModeValue === 'card' ? 'table_rows' : 'grid_view'"
        [bg]="'white'"
        [bghover]="'gray_tone3'"
        [color]="'text_primary'"
        [colorhover]="'primary'"
        [width]="'auto'"
        [rounded]="false"
        [haveContent]="true"
        (clicked)="toggleLayout()"
      >
        {{ layoutModeValue === 'card' ? 'Table View' : 'Card View' }}
      </app-button>

      <div class="add-goalie-button-wrapper" role-visibility-name="add-goalie-button" [attr.role-visibility-team-id]="teamIdValue">
        <app-button
          materialIcon="add"
          [bg]="'primary'"
          [bghover]="'primary_dark'"
          [color]="'white'"
          [colorhover]="'white'"
          [opacity]="1"
          [opacityhover]="1"
          [width]="'auto'"
          [rounded]="false"
          [haveContent]="true"
          (clicked)="openAddGoalieModal()"
        >
          Add a Goalie
        </app-button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (loadingValue) {
    <div class="goalies-loading">
      <div class="loading-text">Loading goalies...</div>
    </div>
  }

  <!-- Empty State -->
  @if (!loadingValue && goaliesValue.length === 0) {
    <div class="goalies-empty">
      <div class="empty-text">No goalies found.</div>
    </div>
  }

  <!-- Content based on layout mode -->
  @if (!loadingValue && goaliesValue.length > 0) {
    @if (layoutModeValue === 'card') {
      <!-- Card View -->
      <div class="goalies-cards-container">
        @for (goalie of goaliesValue; track goalie.id) {
          <div class="goalie-card">
            <!-- Card Header -->
            <div class="goalie-card-header">
              <div class="header-left">
                <div class="goalie-name-row">
                  <div class="goalie-avatar">
                    {{ getGoalieInitials(goalie) }}
                  </div>
                  <div class="goalie-name-group">
                    <div
                      class="goalie-name goalie-link"
                      (click)="viewGoalieProfile(goalie)"
                      (keyup.enter)="viewGoalieProfile(goalie)"
                      (keyup.space)="viewGoalieProfile(goalie)"
                      tabindex="0"
                      role="button"
                      [attr.aria-label]="'View ' + goalie.firstName + ' ' + goalie.lastName + ' profile'"
                    >{{ goalie.firstName }} {{ goalie.lastName }}</div>
                    <div class="goalie-jersey-row">
                      @if (goalie.jerseyNumber) {
                        <div class="goalie-jersey">#{{ goalie.jerseyNumber }}</div>
                      }
                      @if (goalie.birthYear) {
                        <div class="goalie-info-item">
                          <span class="goalie-info-label">Birth Year:</span>
                          <span class="goalie-info-value">{{ goalie.birthYear }}</span>
                        </div>
                      }
                    </div>
                  </div>
                </div>
                <div class="goalie-info-row">
                  <div class="goalie-info-item">
                    <span class="goalie-info-label">Position:</span>
                    <span class="goalie-info-value">{{ goalie.position || 'Goalie' }}</span>
                  </div>
                  @if (goalie.height) {
                    <div class="goalie-info-item">
                      <span class="goalie-info-label">Height:</span>
                      <span class="goalie-info-value">{{ goalie.height }}</span>
                    </div>
                  }
                  @if (goalie.weight) {
                    <div class="goalie-info-item">
                      <span class="goalie-info-label">Weight:</span>
                      <span class="goalie-info-value">{{ goalie.weight }} lbs</span>
                    </div>
                  }
                  @if (goalie.shoots) {
                    <div class="goalie-info-item">
                      <span class="goalie-info-label">Shoots:</span>
                      <span class="goalie-info-value">{{ goalie.shoots }}</span>
                    </div>
                  }
                  @if (goalie.team) {
                    <div class="goalie-info-item">
                      <span class="goalie-info-label">Team:</span>
                      <div class="team-name-with-logo">
                        @if (goalie['teamLogo']) {
                          <img [src]="goalie['teamLogo']" [alt]="goalie.team" class="team-logo-small" />
                        }
                        @if (goalie.teamId) {
                          <span
                            class="goalie-info-value team-link"
                            (click)="goToTeamProfile(goalie.teamId)"
                            (keyup.enter)="goToTeamProfile(goalie.teamId)"
                            (keyup.space)="goToTeamProfile(goalie.teamId)"
                            tabindex="0"
                            role="button"
                            [attr.aria-label]="'View ' + goalie.team + ' profile'"
                          >{{ goalie.team }}</span>
                        } @else {
                          <span class="goalie-info-value">{{ goalie.team }}</span>
                        }
                      </div>
                    </div>
                  }
                </div>
              </div>
            </div>

            <!-- Stats Section -->
            <div class="goalie-stats-section">
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-label">GP</div>
                  <div class="stat-value">{{ goalie.gamesPlayed || 0 }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">W</div>
                  <div class="stat-value">{{ goalie.wins || 0 }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Saves</div>
                  <div class="stat-value">{{ goalie.saves || 0 }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">GA</div>
                  <div class="stat-value">{{ goalie.goalsAgainst || 0 }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">L</div>
                  <div class="stat-value">{{ goalie.losses || 0 }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">SOG</div>
                  <div class="stat-value">{{ goalie.shotsOnGoal || 0 }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">G</div>
                  <div class="stat-value">{{ goalie.goals || 0 }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">A</div>
                  <div class="stat-value">{{ goalie.assists || 0 }}</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">PTS</div>
                  <div class="stat-value stat-value-highlight">{{ goalie.points || 0 }}</div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="goalie-card-actions">
              <app-button-route
                [route]="'/teams-and-rosters/goalies/' + goalie.id + '/spray-chart'"
                [bg]="'secondary'"
                [bghover]="'secondary_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                [materialIcon]="'scatter_plot'"
                [haveContent]="true"
                class="action-button"
              >
                Spray Chart
              </app-button-route>
              <app-button-route
                [route]="'/teams-and-rosters/goalies/' + goalie.id + '/profile'"
                [bg]="'green'"
                [bghover]="'green_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                [materialIcon]="'visibility'"
                [haveContent]="true"
                class="action-button"
              >
                Profile
              </app-button-route>
              <app-button
                [bg]="'orange'"
                [bghover]="'orange_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                materialIcon="stylus"
                [haveContent]="true"
                (clicked)="editGoalie(goalie)"
                class="action-button"
                role-visibility-name="edit-action"
              >
                Edit
              </app-button>
              <app-button
                [bg]="'primary'"
                [bghover]="'primary_dark'"
                [color]="'white'"
                [colorhover]="'white'"
                [materialIcon]="'delete'"
                [haveContent]="true"
                (clicked)="deleteGoalie(goalie)"
                class="action-button"
                role-visibility-name="delete-action"
              >
                Delete
              </app-button>
            </div>
          </div>
        }
      </div>
    } @else {
      <!-- Table View -->
      <div class="goalies-table-container">
        <app-data-table
          [columns]="tableColumns"
          [data]="goaliesValue"
          [actions]="tableActions"
          [loading]="loadingValue"
          (actionClick)="onActionClick($event)"
          (sort)="onSort($event)"
          emptyMessage="No goalies found."
        ></app-data-table>
      </div>
    }
  }
</div>
