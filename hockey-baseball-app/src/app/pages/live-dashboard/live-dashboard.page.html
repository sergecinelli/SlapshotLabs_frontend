@let tournamentNameValue = tournamentName();
@let tournamentTypeValue = tournamentType();
@let tournamentCategoryValue = tournamentCategory();
@let tournamentDateValue = tournamentDate();
@let arenaInfoValue = arenaInfo();
@let awayTeamValue = awayTeam();
@let homeTeamValue = homeTeam();
@let awayStatsValue = awayStats();
@let homeStatsValue = homeStats();
@let gameEventsValue = gameEvents();
@let isLoadingSprayChartsValue = isLoadingSprayCharts();
@let awaySprayChartDataValue = awaySprayChartData();
@let homeSprayChartDataValue = homeSprayChartData();

<div class="page-content space-y-6" [appVisibilityMap]="visibilityByRoleMap">

  <!-- Loading Spinner -->
  @if (isLoadingGameData) {
    <div class="flex items-center justify-center min-h-[60vh]">
      <div class="text-center">
        <mat-spinner diameter="60" class="mx-auto"></mat-spinner>
        <p class="mt-4 text-gray-600 text-lg">Loading game data...</p>
      </div>
    </div>
  }

  <!-- All content wrapped to hide while loading -->
  @if (!isLoadingGameData) {
    <div class="dashboard-cards-container">
      <!-- Tournament Info Header -->
      <div class="live-dashboard-tournament-header">
        <div class="tournament-header-left">
          <div class="tournament-name">{{ tournamentNameValue }}</div>
        </div>
        <div class="tournament-header-center">
          <div class="tournament-type">{{ tournamentTypeValue }}</div>
          <div class="tournament-category">{{ tournamentCategoryValue }}</div>
        </div>
        <div class="tournament-header-right">
          <div class="tournament-info-item">
            <span class="material-symbols-rounded tournament-info-icon">event</span>
            <span class="tournament-info-text">{{ tournamentDateValue }}</span>
          </div>
          <div class="tournament-info-item">
            <span class="material-symbols-rounded tournament-info-icon">place</span>
            <span class="tournament-info-text">{{ arenaInfoValue }}</span>
          </div>
        </div>
      </div>
      <!-- Game Score Section -->
      <div class="live-dashboard-score-card">
        <!-- Period Selector Header -->
        <div class="score-card-period-header">
          @if (!isGameOver) {
            <mat-form-field class="period-select-field">
              <mat-select
                [(ngModel)]="currentPeriodId"
                (selectionChange)="onPeriodChange($event.value)"
                [panelClass]="'period-select-panel'"
                >
                @for (period of periodOptions; track period) {
                  <mat-option [value]="period.value">
                    {{ period.label }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
          } @else {
            <div class="period-final-label">Final</div>
          }
        </div>
        <!-- Teams and Score Section -->
        <div class="game-teams-section">
          <!-- Away Team -->
          <div class="team-section team-section-left" [class.winning]="awayTeamValue.score > homeTeamValue.score">
            <div class="team-info team-info-left">
              <div class="team-name-group">
                <div class="team-location">
                  {{ awayTeamValue.teamLevel }}
                  <span class="team-role-label">Visitor</span>
                </div>
                <div class="team-name">{{ awayTeamValue.name }}</div>
                <div class="team-record">{{ awayTeamValue.record }}</div>
              </div>
              <img [src]="awayTeamValue.logo" [alt]="awayTeamValue.name" class="team-logo" />
            </div>
          </div>
          <!-- Score in Center -->
          <div class="score-center-container">
            <div class="score-wrapper">
              <div class="team-score-wrapper" [class.winning-away]="awayTeamValue.score > homeTeamValue.score">
                <div class="team-score" [class.winning-score]="awayTeamValue.score > homeTeamValue.score">{{ awayTeamValue.score }}</div>
                <div class="team-sog">SOG: {{ awayTeamValue.sog }}</div>
              </div>
              <div class="score-separator">-</div>
              <div class="team-score-wrapper" [class.winning-home]="homeTeamValue.score > awayTeamValue.score">
                <div class="team-score" [class.winning-score]="homeTeamValue.score > awayTeamValue.score">{{ homeTeamValue.score }}</div>
                <div class="team-sog">SOG: {{ homeTeamValue.sog }}</div>
              </div>
            </div>
          </div>
          <!-- Home Team -->
          <div class="team-section team-section-right" [class.winning]="homeTeamValue.score > awayTeamValue.score">
            <div class="team-info team-info-right">
              <img [src]="homeTeamValue.logo" [alt]="homeTeamValue.name" class="team-logo" />
              <div class="team-name-group">
                <div class="team-location">
                  {{ homeTeamValue.teamLevel }}
                  <span class="team-role-label">Home</span>
                </div>
                <div class="team-name">{{ homeTeamValue.name }}</div>
                <div class="team-record">{{ homeTeamValue.record }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Game Event Actions (Unified Section) -->
      @if (!isLoadingGameData) {
        <div class="live-dashboard-actions-wrapper" role-visibility-name="add-event-button" [attr.role-visibility-team-id]="[homeTeamId, awayTeamId]">
          <div class="flex flex-wrap gap-3 justify-center">
            <app-button
              [bg]="'primary'"
              [bghover]="'primary_dark'"
              [color]="'white'"
              [colorhover]="'white'"
              [materialIcon]="'sports_hockey'"
              [haveContent]="true"
              (clicked)="onShots()"
              >
              Shots
            </app-button>
            <app-button
              [bg]="'primary'"
              [bghover]="'primary_dark'"
              [color]="'white'"
              [colorhover]="'white'"
              [materialIcon]="'swap_horiz'"
              [haveContent]="true"
              (clicked)="onTurnover()"
              >
              Turnover
            </app-button>
            <app-button
              [bg]="'primary'"
              [bghover]="'primary_dark'"
              [color]="'white'"
              [colorhover]="'white'"
              [materialIcon]="'sports'"
              [haveContent]="true"
              (clicked)="onFaceoff()"
              >
              Faceoff
            </app-button>
            <app-button
              [bg]="'primary'"
              [bghover]="'primary_dark'"
              [color]="'white'"
              [colorhover]="'white'"
              [materialIcon]="'shield'"
              [haveContent]="true"
              (clicked)="onGoalieChange()"
              >
              Goalie Change
            </app-button>
            <app-button
              [bg]="'primary'"
              [bghover]="'primary_dark'"
              [color]="'white'"
              [colorhover]="'white'"
              [materialIcon]="'gavel'"
              [haveContent]="true"
              (clicked)="onPenalty()"
              >
              Penalty
            </app-button>
          </div>
        </div>
      }
      <!-- Stats Section - Two Team Boxes Side by Side -->
      <div class="grid grid-cols-2 gap-6">
        <!-- Away Team Stats Box -->
        <div class="live-dashboard-stats-card">
          <div class="stats-card-title">
            <img [src]="awayTeamValue.logo" [alt]="awayTeamValue.name" class="stats-card-team-logo" />
            <span>{{ awayTeamValue.name }}</span>
          </div>
          <div class="stats-card-content">
            <div class="space-y-4">
              <!-- Faceoff Win % and Defensive Zone Exit Row -->
              <div class="grid grid-cols-[auto_2.5fr] gap-4">
                <!-- Faceoff Win % -->
                <div class="stat-card">
                  <div class="stat-label">Faceoff Win %</div>
                  <div class="stat-value">{{ awayStatsValue.faceoffWinPct }}%</div>
                </div>
                <!-- Defensive Zone Exit -->
                <div class="stat-section">
                  <div class="stat-section-title">
                    Defensive Zone Exit
                  </div>
                  <div class="grid grid-cols-5 gap-1 text-center">
                    <div>
                      <div class="text-[12px] mb-1">Icing</div>
                      <button
                        (click)="incrementDefensiveZoneExit('away', 'icing')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ awayStatsValue.defensiveZoneExit.icing }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('away', 'icing')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                    <div>
                      <div class="text-[12px] mb-1">Skate</div>
                      <button
                        (click)="incrementDefensiveZoneExit('away', 'skate')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ awayStatsValue.defensiveZoneExit.skate }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('away', 'skate')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                    <div>
                      <div class="text-[12px] mb-1">SO&Win</div>
                      <button
                        (click)="incrementDefensiveZoneExit('away', 'soWin')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ awayStatsValue.defensiveZoneExit.soWin }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('away', 'soWin')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                    <div>
                      <div class="text-[12px] mb-1">SO&Lose</div>
                      <button
                        (click)="incrementDefensiveZoneExit('away', 'soLose')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ awayStatsValue.defensiveZoneExit.soLose }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('away', 'soLose')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                    <div>
                      <div class="text-[12px] mb-1">Pass</div>
                      <button
                        (click)="incrementDefensiveZoneExit('away', 'pass')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ awayStatsValue.defensiveZoneExit.pass }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('away', 'pass')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Offensive Zone Entry -->
              <div class="stat-section">
                <div class="stat-section-title">
                  Offensive Zone Entry
                </div>
                <div class="grid grid-cols-4 gap-1 text-center">
                  <div>
                    <div class="text-[12px] mb-1">Pass</div>
                    <button
                      (click)="incrementOffensiveZoneEntry('away', 'pass')"
                      class="stat-increment-btn"
                      >
                      <img src="assets/icons/up-button.svg" alt="Increment" />
                    </button>
                    <div class="text-sm font-semibold my-1">
                      {{ awayStatsValue.offensiveZoneEntry.pass }}
                    </div>
                    <button
                      (click)="decrementOffensiveZoneEntry('away', 'pass')"
                      class="stat-decrement-btn"
                      >
                      <img src="assets/icons/down-button.svg" alt="Decrement" />
                    </button>
                  </div>
                  <div>
                    <div class="text-[12px] mb-1">Dump/W</div>
                    <button
                      (click)="incrementOffensiveZoneEntry('away', 'dump')"
                      class="stat-increment-btn"
                      >
                      <img src="assets/icons/up-button.svg" alt="Increment" />
                    </button>
                    <div class="text-sm font-semibold my-1">
                      {{ awayStatsValue.offensiveZoneEntry.dump }}
                    </div>
                    <button
                      (click)="decrementOffensiveZoneEntry('away', 'dump')"
                      class="stat-decrement-btn"
                      >
                      <img src="assets/icons/down-button.svg" alt="Decrement" />
                    </button>
                  </div>
                  <div>
                    <div class="text-[12px] mb-1">Dump/L</div>
                    <button
                      (click)="incrementOffensiveZoneEntry('away', 'carry')"
                      class="stat-increment-btn"
                      >
                      <img src="assets/icons/up-button.svg" alt="Increment" />
                    </button>
                    <div class="text-sm font-semibold my-1">
                      {{ awayStatsValue.offensiveZoneEntry.carry }}
                    </div>
                    <button
                      (click)="decrementOffensiveZoneEntry('away', 'carry')"
                      class="stat-decrement-btn"
                      >
                      <img src="assets/icons/down-button.svg" alt="Decrement" />
                    </button>
                  </div>
                  <div>
                    <div class="text-[12px] mb-1">Skated</div>
                    <button
                      (click)="incrementOffensiveZoneEntry('away', 'skated')"
                      class="stat-increment-btn"
                      >
                      <img src="assets/icons/up-button.svg" alt="Increment" />
                    </button>
                    <div class="text-sm font-semibold my-1">
                      {{ awayStatsValue.offensiveZoneEntry.skated }}
                    </div>
                    <button
                      (click)="decrementOffensiveZoneEntry('away', 'skated')"
                      class="stat-decrement-btn"
                      >
                      <img src="assets/icons/down-button.svg" alt="Decrement" />
                    </button>
                  </div>
                </div>
              </div>
              <!-- Shots -->
              <div class="stat-section">
                <div class="stat-section-title">Shots</div>
                <div class="grid grid-cols-4 gap-1 text-center">
                  <div>
                    <div class="text-[12px]">Shots on Goal</div>
                    <div class="text-sm font-semibold">{{ awayStatsValue.shots.shotsOnGoal }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Missed Net</div>
                    <div class="text-sm font-semibold">{{ awayStatsValue.shots.missedNet }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Scoring Chances</div>
                    <div class="text-sm font-semibold">{{ awayStatsValue.shots.scoringChances }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Blocked</div>
                    <div class="text-sm font-semibold">{{ awayStatsValue.shots.blocked }}</div>
                  </div>
                </div>
              </div>
              <!-- Turnovers -->
              <div class="stat-section">
                <div class="stat-section-title">Turnovers</div>
                <div class="grid grid-cols-3 gap-2 text-center">
                  <div>
                    <div class="text-[12px]">Off Zone</div>
                    <div class="text-sm font-semibold">{{ awayStatsValue.turnovers.offZone }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Neutral Zone</div>
                    <div class="text-sm font-semibold">{{ awayStatsValue.turnovers.neutralZone }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Def. Zone</div>
                    <div class="text-sm font-semibold">{{ awayStatsValue.turnovers.defZone }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Home Team Stats Box -->
        <div class="live-dashboard-stats-card">
          <div class="stats-card-title">
            <img [src]="homeTeamValue.logo" [alt]="homeTeamValue.name" class="stats-card-team-logo" />
            <span>{{ homeTeamValue.name }}</span>
          </div>
          <div class="stats-card-content">
            <div class="space-y-4">
              <!-- Faceoff Win % and Defensive Zone Exit Row -->
              <div class="grid grid-cols-[auto_2.5fr] gap-4">
                <!-- Faceoff Win % -->
                <div class="stat-card">
                  <div class="stat-label">Faceoff Win %</div>
                  <div class="stat-value">{{ homeStatsValue.faceoffWinPct }}%</div>
                </div>
                <!-- Defensive Zone Exit -->
                <div class="stat-section">
                  <div class="stat-section-title">
                    Defensive Zone Exit
                  </div>
                  <div class="grid grid-cols-5 gap-1 text-center">
                    <div>
                      <div class="text-[12px] mb-1">Icing</div>
                      <button
                        (click)="incrementDefensiveZoneExit('home', 'icing')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ homeStatsValue.defensiveZoneExit.icing }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('home', 'icing')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                    <div>
                      <div class="text-[12px] mb-1">Skate</div>
                      <button
                        (click)="incrementDefensiveZoneExit('home', 'skate')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ homeStatsValue.defensiveZoneExit.skate }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('home', 'skate')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                    <div>
                      <div class="text-[12px] mb-1">SO&Win</div>
                      <button
                        (click)="incrementDefensiveZoneExit('home', 'soWin')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ homeStatsValue.defensiveZoneExit.soWin }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('home', 'soWin')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                    <div>
                      <div class="text-[12px] mb-1">SO&Lose</div>
                      <button
                        (click)="incrementDefensiveZoneExit('home', 'soLose')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ homeStatsValue.defensiveZoneExit.soLose }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('home', 'soLose')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                    <div>
                      <div class="text-[12px] mb-1">Pass</div>
                      <button
                        (click)="incrementDefensiveZoneExit('home', 'pass')"
                        class="stat-increment-btn"
                        >
                        <img src="assets/icons/up-button.svg" alt="Increment" />
                      </button>
                      <div class="text-sm font-semibold my-1">
                        {{ homeStatsValue.defensiveZoneExit.pass }}
                      </div>
                      <button
                        (click)="decrementDefensiveZoneExit('home', 'pass')"
                        class="stat-decrement-btn"
                        >
                        <img src="assets/icons/down-button.svg" alt="Decrement" />
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Offensive Zone Entry -->
              <div class="stat-section">
                <div class="stat-section-title">
                  Offensive Zone Entry
                </div>
                <div class="grid grid-cols-4 gap-1 text-center">
                  <div>
                    <div class="text-[12px] mb-1">Pass</div>
                    <button
                      (click)="incrementOffensiveZoneEntry('home', 'pass')"
                      class="stat-increment-btn"
                      >
                      <img src="assets/icons/up-button.svg" alt="Increment" />
                    </button>
                    <div class="text-sm font-semibold my-1">
                      {{ homeStatsValue.offensiveZoneEntry.pass }}
                    </div>
                    <button
                      (click)="decrementOffensiveZoneEntry('home', 'pass')"
                      class="stat-decrement-btn"
                      >
                      <img src="assets/icons/down-button.svg" alt="Decrement" />
                    </button>
                  </div>
                  <div>
                    <div class="text-[12px] mb-1">Dump/W</div>
                    <button
                      (click)="incrementOffensiveZoneEntry('home', 'dump')"
                      class="stat-increment-btn"
                      >
                      <img src="assets/icons/up-button.svg" alt="Increment" />
                    </button>
                    <div class="text-sm font-semibold my-1">
                      {{ homeStatsValue.offensiveZoneEntry.dump }}
                    </div>
                    <button
                      (click)="decrementOffensiveZoneEntry('home', 'dump')"
                      class="stat-decrement-btn"
                      >
                      <img src="assets/icons/down-button.svg" alt="Decrement" />
                    </button>
                  </div>
                  <div>
                    <div class="text-[12px] mb-1">Dump/L</div>
                    <button
                      (click)="incrementOffensiveZoneEntry('home', 'carry')"
                      class="stat-increment-btn"
                      >
                      <img src="assets/icons/up-button.svg" alt="Increment" />
                    </button>
                    <div class="text-sm font-semibold my-1">
                      {{ homeStatsValue.offensiveZoneEntry.carry }}
                    </div>
                    <button
                      (click)="decrementOffensiveZoneEntry('home', 'carry')"
                      class="stat-decrement-btn"
                      >
                      <img src="assets/icons/down-button.svg" alt="Decrement" />
                    </button>
                  </div>
                  <div>
                    <div class="text-[12px] mb-1">Skated</div>
                    <button
                      (click)="incrementOffensiveZoneEntry('home', 'skated')"
                      class="stat-increment-btn"
                      >
                      <img src="assets/icons/up-button.svg" alt="Increment" />
                    </button>
                    <div class="text-sm font-semibold my-1">
                      {{ homeStatsValue.offensiveZoneEntry.skated }}
                    </div>
                    <button
                      (click)="decrementOffensiveZoneEntry('home', 'skated')"
                      class="stat-decrement-btn"
                      >
                      <img src="assets/icons/down-button.svg" alt="Decrement" />
                    </button>
                  </div>
                </div>
              </div>
              <!-- Shots -->
              <div class="stat-section">
                <div class="stat-section-title">Shots</div>
                <div class="grid grid-cols-4 gap-1 text-center">
                  <div>
                    <div class="text-[12px]">Shots on Goal</div>
                    <div class="text-sm font-semibold">{{ homeStatsValue.shots.shotsOnGoal }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Missed Net</div>
                    <div class="text-sm font-semibold">{{ homeStatsValue.shots.missedNet }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Scoring Chances</div>
                    <div class="text-sm font-semibold">{{ homeStatsValue.shots.scoringChances }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Blocked</div>
                    <div class="text-sm font-semibold">{{ homeStatsValue.shots.blocked }}</div>
                  </div>
                </div>
              </div>
              <!-- Turnovers -->
              <div class="stat-section">
                <div class="stat-section-title">Turnovers</div>
                <div class="grid grid-cols-3 gap-2 text-center">
                  <div>
                    <div class="text-[12px]">Off Zone</div>
                    <div class="text-sm font-semibold">{{ homeStatsValue.turnovers.offZone }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Neutral Zone</div>
                    <div class="text-sm font-semibold">{{ homeStatsValue.turnovers.neutralZone }}</div>
                  </div>
                  <div>
                    <div class="text-[12px]">Def. Zone</div>
                    <div class="text-sm font-semibold">{{ homeStatsValue.turnovers.defZone }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Events Section (Full Width) -->
  @if (!isLoadingGameData) {
    <div class="live-dashboard-card">
      <div class="live-dashboard-card-header">
        <h2 class="live-dashboard-card-title">Game Events</h2>
      </div>
      <div class="live-dashboard-card-content">
        <!-- Events Table -->
        <div class="live-dashboard-table-wrapper">
          <table class="live-dashboard-table">
            <thead class="live-dashboard-table-header">
              <tr>
                <th class="live-dashboard-table-th w-12">#</th>
                <th class="live-dashboard-table-th">Time</th>
                <th class="live-dashboard-table-th">Team</th>
                <th class="live-dashboard-table-th">Event</th>
                <th class="live-dashboard-table-th">Player</th>
                <th class="live-dashboard-table-th">Description</th>
                <th class="live-dashboard-table-th">Actions</th>
              </tr>
            </thead>
            <tbody class="live-dashboard-table-body">
              @if (gameEventsValue.length === 0) {
                <tr>
                  <td colspan="7" class="live-dashboard-table-empty">
                    <div class="live-dashboard-empty-content">
                      <span class="material-symbols-rounded live-dashboard-empty-icon">event_note</span>
                      <p class="live-dashboard-empty-title">No game events yet</p>
                      <p class="live-dashboard-empty-text">Events will appear here as the game progresses</p>
                    </div>
                  </td>
                </tr>
              } @else {
                @for (event of gameEventsValue; track event.id) {
                  @if (event.period) {
                    <tr class="live-dashboard-period-row">
                      <td class="live-dashboard-period-cell" colspan="7">
                        {{ event.period }}
                      </td>
                    </tr>
                  } @else {
                    <tr
                      class="live-dashboard-table-row"
                      [class.live-dashboard-goal-row]="event.shotType === 'goal'"
                      >
                      <td class="live-dashboard-table-td text-center font-semibold">
                        {{ event.index ?? 'â€”' }}
                      </td>
                      <td class="live-dashboard-table-td">{{ event.time }}</td>
                      <td class="live-dashboard-table-td">
                        <div class="live-dashboard-team-cell">
                          <div class="live-dashboard-team-logo-wrapper">
                            @if (event.teamId) {
                              <img
                                [src]="getTeamLogoUrl(event.teamId)"
                                [alt]="event.team"
                                class="live-dashboard-team-logo"
                                />
                            }
                          </div>
                          <span class="live-dashboard-team-name">{{ event.team }}</span>
                        </div>
                      </td>
                      <td class="live-dashboard-table-td">{{ event.event }}</td>
                      <td class="live-dashboard-table-td">
                        @if (event.playerNumber) {
                          <span class="live-dashboard-player-number">{{ event.playerNumber }}</span>
                        }
                        {{ event.player }}
                      </td>
                      <td class="live-dashboard-table-td">{{ event.description }}</td>
                      <td class="live-dashboard-table-td">
                        <div class="flex gap-1">
                          <button
                            mat-icon-button
                            color="primary"
                            [disabled]="!isYouTubeLinkValid(event.rawEventData?.youtube_link)"
                        [matTooltip]="
                          isYouTubeLinkValid(event.rawEventData?.youtube_link)
                            ? 'Video'
                            : 'No valid video link'
                        "
                            (click)="onViewEventVideo(event)"
                            >
                            <span class="material-symbols-rounded">videocam</span>
                          </button>
                          <button
                            mat-icon-button
                            color="primary"
                            matTooltip="Edit"
                            (click)="onEditEvent(event)"
                            role-visibility-name="edit-event-button"
                            [attr.role-visibility-team-id]="[homeTeamId, awayTeamId]"
                            >
                            <span class="material-symbols-rounded">stylus</span>
                          </button>
                          <button
                            mat-icon-button
                            color="warn"
                            matTooltip="Delete"
                            (click)="onDeleteEvent(event.id)"
                            role-visibility-name="delete-event-button"
                            [attr.role-visibility-team-id]="[homeTeamId, awayTeamId]"
                            >
                            <span class="material-symbols-rounded">delete</span>
                          </button>
                        </div>
                      </td>
                    </tr>
                  }
                }
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- Spray Charts Section (Full Width) -->
  @if (!isLoadingGameData) {
    <div
      class="live-dashboard-card"
      >
      <div class="live-dashboard-card-header">
        <h2 class="live-dashboard-card-title live-dashboard-card-title-center">Spray Charts</h2>
      </div>
      <div class="live-dashboard-card-content">
        @if (isLoadingSprayChartsValue) {
          <div class="live-dashboard-loading">
            <mat-spinner diameter="60" class="mx-auto"></mat-spinner>
            <p class="live-dashboard-loading-text">Loading spray charts...</p>
          </div>
        }
        @if (!isLoadingSprayChartsValue) {
          <div class="grid grid-cols-2 gap-6">
            <!-- Away Team Spray Chart -->
            <div>
              <div class="live-dashboard-spray-chart-header">
                <img
                  [src]="getTeamLogoUrl(awayTeamId)"
                  [alt]="awayTeamValue.name"
                  class="live-dashboard-spray-chart-logo"
                  />
                <h3 class="live-dashboard-spray-chart-title">{{ awayTeamValue.name }}</h3>
              </div>
              @if (awaySprayChartDataValue.length > 0) {
                <app-shot-location-display
                  [data]="awaySprayChartDataValue"
                  [storageKey]="StorageKey.LiveDashboardAwaySprayChart"
                  [teamId]="homeTeamId"
                  [teamName]="homeTeamValue.name"
                  [goalieId]="homeStartGoalieId"
                  [goalieName]="homeGoalieName"
                  [showDirection]="true"
                ></app-shot-location-display>
              } @else {
                <div class="live-dashboard-empty-chart">
                  <span class="material-symbols-rounded live-dashboard-empty-chart-icon">sports_hockey</span>
                  <p class="live-dashboard-empty-chart-text">No spray chart data available</p>
                </div>
              }
            </div>
            <!-- Home Team Spray Chart -->
            <div>
              <div class="live-dashboard-spray-chart-header">
                <img
                  [src]="getTeamLogoUrl(homeTeamId)"
                  [alt]="homeTeamValue.name"
                  class="live-dashboard-spray-chart-logo"
                  />
                <h3 class="live-dashboard-spray-chart-title">{{ homeTeamValue.name }}</h3>
              </div>
              @if (homeSprayChartDataValue.length > 0) {
                <app-shot-location-display
                  [data]="homeSprayChartDataValue"
                  [storageKey]="StorageKey.LiveDashboardHomeSprayChart"
                  [teamId]="awayTeamId"
                  [teamName]="awayTeamValue.name"
                  [goalieId]="awayStartGoalieId"
                  [goalieName]="awayGoalieName"
                  [showDirection]="true"
                ></app-shot-location-display>
              } @else {
                <div class="live-dashboard-empty-chart">
                  <span class="material-symbols-rounded live-dashboard-empty-chart-icon">sports_hockey</span>
                  <p class="live-dashboard-empty-chart-text">No spray chart data available</p>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>
<!-- End content wrapper -->
